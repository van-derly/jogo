<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoQuiz Blitz - 8¬∫ Ano</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #020617 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .glass {
            background: rgba(250, 249, 246, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7);
            background-image: radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .timer-bar {
            transition: width 0.1s linear, background-color 0.3s;
        }
        .option-btn {
            transition: all 0.2s ease;
        }
        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .option-btn:active:not(:disabled) {
            transform: translateY(0);
        }
        .correct-answer { background-color: #4ade80 !important; color: white !important; border-color: #22c55e !important; }
        .wrong-answer { background-color: #f87171 !important; color: white !important; border-color: #ef4444 !important; }
        
        /* Ocultar scrollbar mas permitir rolagem */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <!-- Container Principal -->
    <div id="app-container" class="glass rounded-3xl w-full max-w-lg p-6 sm:p-8 relative overflow-hidden">
        
        <!-- Tela Inicial -->
        <div id="screen-home" class="text-center space-y-5">
            <div class="inline-block px-4 py-2 border-4 border-red-600 rounded-lg mb-2 opacity-90 rotate-[-5deg]">
                <span class="text-red-600 font-black text-3xl tracking-widest uppercase">Ultra Secreto</span>
            </div>
            <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">Opera√ß√£o: GeoQuiz</h1>
            <p class="text-gray-600 font-medium leading-relaxed px-2">
                198X. O mundo est√° dividido e a tens√£o √© m√°xima. Voc√™ √© um agente duplo com a miss√£o de interceptar dossi√™s geopol√≠ticos.
            </p>
            
            <div class="bg-gray-900 p-4 rounded-xl text-sm text-left text-green-400 space-y-2 shadow-inner font-mono">
                <p class="text-green-500"><strong>> TERMINAL DE MISS√ÉO ATIVO_</strong></p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Sua miss√£o tem 3 N√≠veis de Seguran√ßa (8 documentos cada).</li>
                    <li>Descriptografe no m√≠nimo <strong>4 arquivos</strong> para n√£o ser descoberto.</li>
                    <li><span class="text-red-400">Risco Cr√≠tico:</span> Os dados se autodestroem entre <strong>8 a 12 SEGUNDOS!</strong></li>
                    <li>Erros ou tempo esgotado penalizam em <strong class="text-red-400">-50 pontos</strong>.</li>
                </ul>
            </div>

            <button onclick="startGame()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-xl text-lg transition-colors shadow-lg shadow-red-200">
                üï∂Ô∏è ACEITAR MISS√ÉO
            </button>
            <button onclick="showScreen('screen-ranking')" class="w-full bg-white text-gray-700 border-2 border-gray-300 hover:bg-gray-50 font-bold py-3 rounded-xl transition-colors">
                üìÅ Acessar Dossi√™s (Ranking)
            </button>
        </div>

        <!-- Tela de Transi√ß√£o de Fase -->
        <div id="screen-phase" class="hidden text-center space-y-6 py-10">
            <h2 id="phase-title" class="text-4xl font-extrabold text-gray-800">Fase 1</h2>
            <p id="phase-subtitle" class="text-xl text-gray-600 font-semibold">N√≠vel F√°cil</p>
            <div class="animate-bounce text-5xl mt-8">‚è±Ô∏è</div>
            <p class="text-sm text-gray-500 mt-4">Prepare-se...</p>
        </div>

        <!-- Tela do Jogo -->
        <div id="screen-game" class="hidden flex flex-col h-full">
            <!-- Header do Jogo -->
            <div class="flex justify-between items-center mb-4 text-sm font-bold text-gray-600">
                <span id="game-phase-indicator" class="bg-gray-200 px-3 py-1 rounded-full">F√°cil</span>
                <span id="game-score">Pontos: 0</span>
                <span id="game-progress">1/5</span>
            </div>

            <!-- Temporizador -->
            <div class="w-full bg-gray-200 rounded-full h-3 mb-6 overflow-hidden">
                <div id="timer-bar" class="bg-green-500 h-3 rounded-full timer-bar" style="width: 100%"></div>
            </div>

            <!-- Pergunta -->
            <h3 id="question-text" class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 text-center leading-tight min-h-[5rem] flex items-center justify-center">
                Carregando pergunta...
            </h3>

            <!-- Mensagem de Tempo Esgotado -->
            <div id="time-out-msg" class="hidden text-center text-red-500 font-extrabold text-xl mb-3 animate-pulse">
                ‚è∞ TEMPO ESGOTADO! (-50 pts)
            </div>

            <!-- Op√ß√µes -->
            <div id="options-container" class="space-y-3 mt-auto">
                <!-- Bot√µes gerados via JS -->
            </div>
        </div>

        <!-- Tela de Fim de Jogo -->
        <div id="screen-end" class="hidden text-center space-y-6">
            <div id="end-icon" class="text-6xl mb-2">üéâ</div>
            <h2 id="end-title" class="text-3xl font-extrabold text-gray-800">Fim de Jogo!</h2>
            <p id="end-message" class="text-gray-600 font-medium"></p>
            
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-6 rounded-2xl text-white shadow-lg">
                <p class="text-lg opacity-90">Sua Pontua√ß√£o Final</p>
                <p id="final-score" class="text-5xl font-black mt-1">0</p>
            </div>

            <div class="space-y-3 text-left">
                <label class="block text-sm font-bold text-gray-700">Digite seu nome para o Ranking:</label>
                <input type="text" id="player-name" placeholder="Seu nome ou apelido..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" maxlength="15">
            </div>

            <button onclick="saveScore()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition-colors shadow-lg shadow-green-200">
                Salvar Pontua√ß√£o
            </button>
            <button onclick="showScreen('screen-home')" class="w-full text-gray-500 hover:text-gray-800 font-bold py-2">
                Voltar ao In√≠cio (Sem salvar)
            </button>
        </div>

        <!-- Tela de Ranking -->
        <div id="screen-ranking" class="hidden flex flex-col h-[400px]">
            <h2 class="text-2xl font-extrabold text-gray-800 mb-4 text-center">üèÜ Top Alunos</h2>
            
            <div id="ranking-list" class="flex-1 overflow-y-auto space-y-2 mb-4 pr-2">
                <!-- Lista gerada via JS -->
            </div>

            <button onclick="showScreen('screen-home')" class="w-full bg-blue-100 text-blue-800 hover:bg-blue-200 font-bold py-3 rounded-xl transition-colors mt-auto">
                Voltar ao Menu
            </button>
        </div>

    </div>

    <script>
        // --- BANCO DE QUEST√ïES (Conte√∫do de Geografia do 8¬∫ Ano) ---
        const questionBank = {
            facil: [
                { q: "O espa√ßo f√≠sico sobre o qual o Estado exerce poder √© o(a):", options: ["Territ√≥rio", "Na√ß√£o", "Governo", "Cultura"], a: 0 },
                { q: "Qual pa√≠s liderou o bloco Capitalista na Guerra Fria?", options: ["Estados Unidos", "Uni√£o Sovi√©tica", "China", "Jap√£o"], a: 0 },
                { q: "A Uni√£o Sovi√©tica (URSS) representava qual sistema?", options: ["Socialismo", "Capitalismo", "Anarquismo", "Feudalismo"], a: 0 },
                { q: "Institui√ß√£o permanente que administra um pa√≠s:", options: ["Estado", "Governo", "Partido", "Na√ß√£o"], a: 0 },
                { q: "Grupo pol√≠tico que exerce o poder TEMPORARIAMENTE:", options: ["Governo", "Estado", "Territ√≥rio", "Na√ß√£o"], a: 0 },
                { q: "Limites que separam os territ√≥rios dos pa√≠ses:", options: ["Fronteiras", "Na√ß√µes", "Tratados", "Soberanias"], a: 0 },
                { q: "Cultura, l√≠ngua e hist√≥ria comum definem uma:", options: ["Na√ß√£o", "Fronteira", "Soberania", "Alian√ßa"], a: 0 },
                { q: "A Nova Ordem Mundial destacou a ascens√£o de qual pa√≠s asi√°tico?", options: ["China", "Coreia do Norte", "Vietn√£", "√çndia"], a: 0 },
                { q: "Qual era a alian√ßa militar liderada pelos EUA?", options: ["OTAN", "Pacto de Vars√≥via", "ONU", "Mercosul"], a: 0 },
                { q: "A organiza√ß√£o respons√°vel por administrar um territ√≥rio e popula√ß√£o √©:", options: ["O Estado", "A Na√ß√£o", "O Bairro", "A Fronteira"], a: 0 },
                { q: "Em que ano a Uni√£o Sovi√©tica foi desintegrada?", options: ["1991", "1945", "2000", "1989"], a: 0 },
                { q: "A Guerra Fria come√ßou logo ap√≥s qual evento?", options: ["Segunda Guerra Mundial", "Primeira Guerra Mundial", "Guerra do Vietn√£", "Queda do Muro de Berlim"], a: 0 },
                { q: "Rios e montanhas s√£o exemplos de fronteiras:", options: ["Naturais", "Artificiais", "Ideol√≥gicas", "Invis√≠veis"], a: 0 },
                { q: "Qual pa√≠s atual tem forte influ√™ncia econ√¥mica na √Åfrica e Am√©rica Latina?", options: ["China", "Jap√£o", "Inglaterra", "Fran√ßa"], a: 0 },
                { q: "Um Estado sem popula√ß√£o e sem territ√≥rio pode existir?", options: ["N√£o", "Sim", "Apenas na Europa", "Apenas na √Åsia"], a: 0 },
                { q: "A disputa EUA x China hoje √© principalmente:", options: ["Comercial e Tecnol√≥gica", "Nuclear e Espacial", "Religiosa e Cultural", "Apenas Territorial"], a: 0 }
            ],
            media: [
                { q: "A hegemonia apenas dos EUA nos anos 90 formou uma ordem:", options: ["Unipolar", "Bipolar", "Multipolar", "Socialista"], a: 0 },
                { q: "Alian√ßa militar liderada pelos EUA na Guerra Fria:", options: ["OTAN", "Pacto de Vars√≥via", "ONU", "BRICS"], a: 0 },
                { q: "Alian√ßa militar liderada pela URSS:", options: ["Pacto de Vars√≥via", "OTAN", "Uni√£o Europeia", "Mercosul"], a: 0 },
                { q: "Poder supremo e autonomia de um Estado em seu territ√≥rio:", options: ["Soberania", "Globaliza√ß√£o", "Multipolaridade", "Governo"], a: 0 },
                { q: "O fim da Guerra Fria (1991) ocorreu junto com a:", options: ["Fim da URSS", "Queda dos EUA", "Cria√ß√£o da OTAN", "Guerra da Coreia"], a: 0 },
                { q: "Uma Na√ß√£o SEM Estado pr√≥prio geralmente causa:", options: ["Conflitos territoriais", "Paz mundial", "Fim da globaliza√ß√£o", "Aumento de fronteiras naturais"], a: 0 },
                { q: "O mundo atual, com v√°rios centros de poder (UE, China, EUA), √©:", options: ["Multipolar", "Unipolar", "Bipolar", "Apolar"], a: 0 },
                { q: "Bloco de pa√≠ses emergentes que inclui Brasil e China:", options: ["BRICS", "OTAN", "G7", "NAFTA"], a: 0 },
                { q: "O governo de um pa√≠s √© permanente ou tempor√°rio?", options: ["Tempor√°rio", "Permanente", "Eterno", "Vital√≠cio"], a: 0 },
                { q: "Um exemplo de povo que luta por autodetermina√ß√£o e territ√≥rio pr√≥prio:", options: ["Curdos", "Estadunidenses", "Japoneses", "Brasileiros"], a: 0 },
                { q: "Al√©m do capitalismo e socialismo, qual disputa marcou a Guerra Fria?", options: ["Corrida armamentista", "Guerra das moedas", "Combate ao terrorismo", "Disputa por √°gua"], a: 0 },
                { q: "Qual conflito indireto N√ÉO fez parte da Guerra Fria?", options: ["Guerra do Iraque", "Guerra da Coreia", "Guerra do Vietn√£", "Crise dos M√≠sseis"], a: 0 },
                { q: "O unilateralismo dos EUA foi criticado no mundo por causa de:", options: ["Guerras custosas (Iraque/Afeganist√£o)", "Acordos de paz", "Cria√ß√£o da ONU", "Fim do com√©rcio global"], a: 0 },
                { q: "Espa√ßo a√©reo e subsolo fazem parte do:", options: ["Territ√≥rio", "Governo", "Pacto de Vars√≥via", "Organismo Internacional"], a: 0 },
                { q: "O FMI e o Banco Mundial sofreram forte influ√™ncia indireta de qual pa√≠s nos anos 90?", options: ["Estados Unidos", "R√∫ssia", "Alemanha", "Jap√£o"], a: 0 },
                { q: "Com o fim da URSS, qual fen√¥meno econ√¥mico se intensificou no mundo?", options: ["Globaliza√ß√£o", "Isolacionismo", "Feudalismo", "Desindustrializa√ß√£o"], a: 0 }
            ],
            dificil: [
                { q: "O que ajudou a desgastar a hegemonia dos EUA nos anos 2000?", options: ["Crise de 2008 e guerras custosas", "Fim da URSS", "Cria√ß√£o da ONU", "Apoio ao bloco socialista"], a: 0 },
                { q: "A divis√£o da Europa em Oriental e Ocidental marcou a ordem:", options: ["Bipolar", "Unipolar", "Multipolar", "Globalizada"], a: 0 },
                { q: "Guerra da Coreia e do Vietn√£ na Guerra Fria foram exemplos de:", options: ["Conflitos indiretos", "Confronto direto EUA x URSS", "Guerras multipolares", "Tratados de paz"], a: 0 },
                { q: "Qual N√ÉO √© uma fun√ß√£o essencial do Estado?", options: ["Garantir lucros de empresas", "Criar e aplicar leis", "Garantir seguran√ßa", "Manter a ordem interna"], a: 0 },
                { q: "Rivalidade econ√¥mica e tecnol√≥gica atual que define a Nova Ordem:", options: ["EUA x China", "EUA x R√∫ssia", "URSS x Europa", "Brasil x China"], a: 0 },
                { q: "Quando a soberania de um pa√≠s √© amea√ßada, geralmente ocorrem:", options: ["Interven√ß√µes externas", "Acordos comerciais", "Unifica√ß√µes de moedas", "Dissolu√ß√µes do Estado"], a: 0 },
                { q: "Rios e montanhas que dividem pa√≠ses s√£o exemplos de fronteiras:", options: ["Naturais", "Artificiais", "Ideol√≥gicas", "Culturais"], a: 0 },
                { q: "Qual foi a principal caracter√≠stica da Guerra Fria?", options: ["Disputa ideol√≥gica sem confronto militar direto", "Guerra nuclear", "Fim das fronteiras", "Uni√£o entre capitalismo e socialismo"], a: 0 },
                { q: "Para ser considerado Estado, al√©m de popula√ß√£o e territ√≥rio, precisa de:", options: ["Governo e Soberania", "Ex√©rcito e Moeda", "Ind√∫strias e ONU", "Idioma e Religi√£o"], a: 0 },
                { q: "A ascens√£o chinesa nos anos 2000 foi impulsionada por:", options: ["Industrializa√ß√£o acelerada e tecnologia", "Fim das exporta√ß√µes", "Ado√ß√£o total do capitalismo liberal", "Alian√ßa militar com os EUA"], a: 0 },
                { q: "A reorganiza√ß√£o das cadeias produtivas globais hoje reflete as tens√µes da:", options: ["Nova Ordem Mundial", "Guerra Fria", "Velha Ordem Europeia", "Ordem Bipolar"], a: 0 },
                { q: "A Europa Ocidental, durante a Guerra Fria, pertencia ao bloco:", options: ["Capitalista", "Socialista", "N√£o Alinhado", "Sovi√©tico"], a: 0 },
                { q: "O direito de tomar decis√µes internas sem interfer√™ncia externa chama-se:", options: ["Independ√™ncia externa (Soberania)", "Globaliza√ß√£o", "Totalitarismo", "Militariza√ß√£o"], a: 0 },
                { q: "Acordos pol√≠ticos que dividem pa√≠ses formam fronteiras do tipo:", options: ["Artificiais", "Naturais", "Culturais", "Imagin√°rias"], a: 0 },
                { q: "As disputas por territ√≥rios internacionais est√£o mais ligadas √† falta de:", options: ["Fronteiras bem definidas e Estados para certas na√ß√µes", "Armas nucleares", "Tecnologia de ponta", "Acordos econ√¥micos com os EUA"], a: 0 },
                { q: "O mundo ter v√°rios centros de poder significa que o poder est√° mais:", options: ["Distribu√≠do e disputado", "Concentrado em um pa√≠s", "Focado apenas na Europa", "Ignorado pela globaliza√ß√£o"], a: 0 }
            ]
        };

        // --- VARI√ÅVEIS DE ESTADO DO JOGO ---
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let currentPhase = 0; // 0: F√°cil, 1: M√©dia, 2: Dif√≠cil
        let phaseNames = ["F√°cil", "M√©dia", "Dif√≠cil"];
        let phaseCorrectAnswers = 0;
        const questionsPerPhase = 8;
        const minCorrectToPass = 4;
        
        // Temporizadores por fase (12s, 10s, 8s)
        const timeLimits = [12000, 10000, 8000]; 
        let timeRemaining = 0;
        let timerInterval;
        let updateInterval;
        let isAnswering = false;

        // Ranking In-Memory (Zera ao recarregar a p√°gina)
        let ranking = [];

        // --- FUN√á√ïES PRINCIPAIS ---

        function showScreen(screenId) {
            document.querySelectorAll('#app-container > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            if (screenId === 'screen-ranking') renderRanking();
        }

        // Embaralha um array
        function shuffleArray(array) {
            let shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startGame() {
            score = 0;
            currentPhase = 0;
            document.getElementById('game-score').innerText = `Pontos: ${score}`;
            preparePhase();
        }

        function preparePhase() {
            // Sorteia perguntas do n√≠vel atual
            let difficulty = currentPhase === 0 ? 'facil' : (currentPhase === 1 ? 'media' : 'dificil');
            let shuffledBank = shuffleArray(questionBank[difficulty]);
            currentQuestions = shuffledBank.slice(0, questionsPerPhase); 
            currentQuestionIndex = 0;
            phaseCorrectAnswers = 0;

            // Tela de Transi√ß√£o
            showScreen('screen-phase');
            document.getElementById('phase-title').innerText = `Fase ${currentPhase + 1}`;
            document.getElementById('phase-subtitle').innerText = `N√≠vel ${phaseNames[currentPhase]}`;

            setTimeout(() => {
                showScreen('screen-game');
                document.getElementById('game-phase-indicator').innerText = phaseNames[currentPhase];
                loadQuestion();
            }, 2500); // 2.5s de suspense
        }

        function loadQuestion() {
            isAnswering = false;
            let qData = currentQuestions[currentQuestionIndex];
            
            document.getElementById('time-out-msg').classList.add('hidden');
            
            document.getElementById('game-progress').innerText = `${currentQuestionIndex + 1}/${questionsPerPhase}`;
            document.getElementById('question-text').innerText = qData.q;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            // Embaralha as op√ß√µes, guardando qual era a correta
            let optionsWithIndex = qData.options.map((opt, idx) => ({ text: opt, isCorrect: idx === qData.a }));
            let shuffledOptions = shuffleArray(optionsWithIndex);

            shuffledOptions.forEach((opt, idx) => {
                let btn = document.createElement('button');
                btn.className = "w-full bg-white border-2 border-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-xl text-left option-btn";
                btn.innerText = opt.text;
                btn.onclick = () => handleAnswer(opt.isCorrect, btn, shuffledOptions);
                optionsContainer.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            let currentTimeLimit = timeLimits[currentPhase];
            timeRemaining = currentTimeLimit;
            const timerBar = document.getElementById('timer-bar');
            timerBar.style.width = '100%';
            timerBar.className = "bg-green-500 h-3 rounded-full timer-bar"; // Reseta cor

            clearInterval(updateInterval);
            clearInterval(timerInterval);

            // Atualiza visual a cada 50ms para suavidade
            updateInterval = setInterval(() => {
                timeRemaining -= 50;
                let percentage = (timeRemaining / currentTimeLimit) * 100;
                timerBar.style.width = `${Math.max(0, percentage)}%`;

                // Muda cor baseado no tempo
                if(percentage < 30) timerBar.className = "bg-red-500 h-3 rounded-full timer-bar";
                else if(percentage < 60) timerBar.className = "bg-yellow-400 h-3 rounded-full timer-bar";

                if (timeRemaining <= 0) {
                    clearInterval(updateInterval);
                    handleTimeOut();
                }
            }, 50);
        }

        function handleAnswer(isCorrect, selectedBtn, optionsData) {
            if (isAnswering) return;
            isAnswering = true;
            clearInterval(updateInterval);

            const buttons = document.getElementById('options-container').children;
            
            // Desabilita bot√µes e mostra feedback
            for(let i=0; i<buttons.length; i++) {
                buttons[i].disabled = true;
                if(optionsData[i].isCorrect) {
                    buttons[i].classList.add('correct-answer');
                } else if(buttons[i] === selectedBtn && !isCorrect) {
                    buttons[i].classList.add('wrong-answer');
                }
            }

            if (isCorrect) {
                phaseCorrectAnswers++;
                let currentTimeLimit = timeLimits[currentPhase];
                // Pontua√ß√£o: Base (50) + B√¥nus de tempo (at√© 50) * Multiplicador de Fase
                let timeBonus = Math.floor((timeRemaining / currentTimeLimit) * 50);
                let phaseMultiplier = currentPhase + 1; // 1, 2 ou 3
                let pointsEarned = (50 + timeBonus) * phaseMultiplier;
                score += pointsEarned;
            } else {
                // Penalidade por erro
                score = Math.max(0, score - 50);
            }
            
            // Atualiza pontua√ß√£o na tela
            document.getElementById('game-score').innerText = `Pontos: ${score}`;

            setTimeout(nextStep, 1500); // Mostra o resultado por 1.5s
        }

        function handleTimeOut() {
            if (isAnswering) return;
            isAnswering = true;

            document.getElementById('time-out-msg').classList.remove('hidden');

            // Penalidade por tempo esgotado
            score = Math.max(0, score - 50);
            document.getElementById('game-score').innerText = `Pontos: ${score}`;

            const buttons = document.getElementById('options-container').children;
            // Apenas mostra qual era a correta
            // Recupera a l√≥gica das op√ß√µes para achar a correta
            let qData = currentQuestions[currentQuestionIndex];
            
            for(let i=0; i<buttons.length; i++) {
                buttons[i].disabled = true;
                if(buttons[i].innerText === qData.options[qData.a]) {
                    buttons[i].classList.add('correct-answer');
                }
            }

            setTimeout(nextStep, 2000); // Aumentado levemente para o aluno conseguir ler a mensagem
        }

        function nextStep() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questionsPerPhase) {
                loadQuestion();
            } else {
                // Fim da fase - Verifica acertos
                if (phaseCorrectAnswers >= minCorrectToPass) {
                    currentPhase++;
                    if (currentPhase < 3) {
                        preparePhase();
                    } else {
                        endGame(true); // Venceu o jogo inteiro
                    }
                } else {
                    endGame(false); // Game Over por n√£o atingir a meta
                }
            }
        }

        function endGame(victory = true) {
            showScreen('screen-end');
            
            const titleEl = document.getElementById('end-title');
            const iconEl = document.getElementById('end-icon');
            const msgEl = document.getElementById('end-message');
            
            if (victory) {
                iconEl.innerText = 'üéâ';
                titleEl.innerText = 'Fim de Jogo!';
                msgEl.innerText = 'Parab√©ns por concluir todas as fases!';
            } else {
                iconEl.innerText = '‚ùå';
                titleEl.innerText = 'Game Over!';
                msgEl.innerText = `Voc√™ acertou apenas ${phaseCorrectAnswers} de ${questionsPerPhase} na fase ${phaseNames[currentPhase]}. Tente novamente!`;
            }

            document.getElementById('final-score').innerText = score;
            document.getElementById('player-name').value = '';
        }

        function saveScore() {
            let name = document.getElementById('player-name').value.trim();
            if (!name) name = "Aluno An√¥nimo";

            ranking.push({ name: name, score: score });
            
            // Ordena o ranking (maior para menor)
            ranking.sort((a, b) => b.score - a.score);
            
            showScreen('screen-ranking');
        }

        function renderRanking() {
            const list = document.getElementById('ranking-list');
            list.innerHTML = '';

            if (ranking.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-500 mt-10">Nenhuma pontua√ß√£o registrada ainda. Seja o primeiro!</p>';
                return;
            }

            ranking.forEach((entry, index) => {
                let badge = '';
                if(index === 0) badge = 'ü•á';
                else if(index === 1) badge = 'ü•à';
                else if(index === 2) badge = 'ü•â';
                else badge = `<span class="text-gray-400 font-bold ml-1">${index + 1}¬∫</span>`;

                list.innerHTML += `
                    <div class="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl w-8 text-center">${badge}</span>
                            <span class="font-bold text-gray-700">${entry.name}</span>
                        </div>
                        <span class="font-black text-blue-600">${entry.score} pts</span>
                    </div>
                `;
            });
        }

        // Inicializa mostrando a Home
        showScreen('screen-home');
    </script>
</body>
</html>
